// SE.play("102") 

// //air battle fighter
// l.SE.play("102"), //1

// //explosion on ship
// e.prototype.playExplosionSmall = 

// //night double
// e.prototype._attack = function(t, e) { //3

// // attack playe fleet
// e.prototype._attack = function(t, e) { //1

// //
// e.prototype._attack = function(t, e) { //4

// //double attack first
// e.prototype._doubleH = function() {
// //double attack second
// v._cutin.view.once("attack", function() {



// //ship sunk PVP
// v._completeDamageEffect = function() {



// //attack start
// e.prototype.attack = function(t) {

// //common attack  
// createjs.Tween.get(null).wait(r).call(function() {

// //Explosion depends of damage
// e.prototype.playDamageExplosion = function(t, e, i, n) {

// //init attack animation
// //i - _scene texture bg_map/bg_h.png
// //n - attacker
// //o - defender
// var y = new a.PhaseAttackNormal(i,n,o,r,s,c,h);

// //PhaseAttackNormal constructor
// function e(e, i, n, o, s, a, _) {

// //generate animation task for surface battle
// e.prototype._hougekiCycle = function() {//2

//http://203.104.209.87/kcs2/resources/ship/card/0187_2689.png?version=44
///kcs2/resources/ship/card/0187_2689.png
//chrome-extension://nfldpcedekkdpjmmahadaffilbfaofof/assets/img/icon/icon_500.png

// PhaseNelsonTouch  Nelson
// PhaseNagatoAttack  Nagato
// PhaseMutsuAttack  Mutsu
// PhaseColoradoAttack  Colorado
// PhaseAttackDouble double attack
// PhaseAttackBakurai  ASW
// PhaseAttackRaigeki torpedo (Example:CLT with Ko-Hyoteki)
// PhaseAttackRocket anti installation (Example: WG-42)

// PhaseAttackDanchaku Unknown (some _special attack)
// PhaseZRK zuin cut in

// 12.7 gun
// equipType: 1
// equipTypeSp: 1
// iconType: 1
// level: 0
// mem_id: 24213
// mst_id: 1
// name: "12cm単装砲"
// sakuteki: 0
// taiku: 1
// taisen: 0
// _level: 0
// _mem_id: 24213
// _mst_id: 1
// _sakuteki: 0

// equipType: 1
// equipTypeSp: 1
// iconType: 1
// level: 0
// mem_id: 0
// mst_id: 501
// name: "5inch単装砲"
// sakuteki: 0
// taiku: 0
// taisen: 0
// _level: 0
// _mem_id: 0
// _mst_id: 501
// _sakuteki: -1



// equipType: 2
// equipTypeSp: 2
// iconType: 2
// level: 0
// mem_id: 0
// mst_id: 504
// name: "5inch単装高射砲"
// sakuteki: 0
// taiku: 2
// taisen: 0
// _level: 0
// _mem_id: 0
// _mst_id: 504
// _sakuteki: -1


//nanagto
// equipType: 3
// equipTypeSp: 3
// iconType: 3
// level: 0
// mem_id: 4940
// mst_id: 245
// name: "38cm四連装砲"
// sakuteki: 0
// taiku: 1
// taisen: 0
// _level: 0
// _mem_id: 4940
// _mst_id: 245
// _sakuteki: 0
// __proto__: Object

// equipType: 2
// equipTypeSp: 2
// iconType: 2
// level: 0
// mem_id: 8918
// mst_id: 5
// name: "15.5cm三連装砲"
// sakuteki: 0
// taiku: 4
// taisen: 0
// _level: 0
// _mem_id: 8918
// _mst_id: 5
// _sakuteki: 0
// __proto__: Object

// equipType: 1
// equipTypeSp: 1
// iconType: 1
// level: 0
// mem_id: 24019
// mst_id: 2
// name: "12.7cm連装砲"
// sakuteki: 0
// taiku: 2
// taisen: 0
// _level: 0
// _mem_id: 24019
// _mst_id: 2
// _sakuteki: 0
// __proto__: Object

// equipType: 1
// equipTypeSp: 1
// iconType: 16
// level: 0
// mem_id: 9447
// mst_id: 91
// name: "12.7cm連装高角砲(後期型)"
// sakuteki: 0
// taiku: 5
// taisen: 1
// _level: 0
// _mem_id: 9447
// _mst_id: 91
// _sakuteki: 0


// risheley
// equipType: 4
// equipTypeSp: 4
// iconType: 16
// level: 0
// mem_id: 17708
// mst_id: 10
// name: "12.7cm連装高角砲"
// sakuteki: 0
// taiku: 4
// taisen: 0
// _level: 0
// _mem_id: 17708
// _mst_id: 10
// _sakuteki: 0
// __proto__: Object

// equipType: 4
// equipTypeSp: 4
// iconType: 4
// level: 0
// mem_id: 4745
// mst_id: 134
// name: "OTO 152mm三連装速射砲"
// sakuteki: 0
// taiku: 2
// taisen: 0
// _level: 0
// _mem_id: 4745
// _mst_id: 134
// _sakuteki: 0
// __proto__: Object

// equipType: 4
// equipTypeSp: 4
// iconType: 16
// level: 1
// mem_id: 4746
// mst_id: 135
// name: "90mm単装高角砲"
// sakuteki: 0
// taiku: 8
// taisen: 0
// _level: 1
// _mem_id: 4746
// _mst_id: 135
// _sakuteki: 0
// __proto__: Object

// equipType: 4
// equipTypeSp: 4
// iconType: 4
// level: 0
// mem_id: 4941
// mst_id: 247
// name: "15.2cm三連装砲"
// sakuteki: 0
// taiku: 1
// taisen: 0
// _level: 0
// _mem_id: 4941
// _mst_id: 247
// _sakuteki: 0

//AA Cutin
// 0: t
// a_index: 0
// d_indexes: Array(1)
// flag: 0
// type: 6
// _a_index: 0
// _d_indexes: [3]
// _damages: [222]
// _flag: 0
// _hit_types: [1]
// _slotitems: (3) ["59", "104", "104"]
// _type: 6
// __proto__: Object


//prevent load main.js
//prevent run KCS.init()
var elem = document.querySelector('body > canvas'); elem.parentNode.removeChild(elem);
fetch("./js/main.js?version=4.4.2.5")
    .then(b => b.text())
    .then(s => s.replace("e.PhaseAttackNormal=_", "document.kcs_PhaseAttackNormal = e;e.PhaseAttackNormal=_"))
    .then(s => s.replace("e.LayerExplosion=u", "document.kcs_LayerExplosion = e;e.LayerExplosion=u"))
    // .then(s => s.replace("!function(t){function e(t){null!=t&&", "document.kcs_SE = e;!function(t){function e(t){null!=t&&"))
    .then(s => eval(s))


class CustomPhaseAttackNormal extends document.kcs_PhaseAttackNormal.PhaseAttackNormal {
    _playExplosion(t, e) {
        var i = t.getGlobalPos(!0);
        this._scene.view.layer_explosion.playDamageExplosionCustom(i.x, i.y, e)
    }
}
document.kcs_PhaseAttackNormal.PhaseAttackNormal = CustomPhaseAttackNormal


class CustomExplosion extends PIXI.Container {
    constructor() {
        super();
        this._current_frame = 0
        this._img = new PIXI.Sprite
        this.addChild(this._img)
    }


    play(completion) {
        void 0 === completion && (completion = null),
            this._isPlaying || (this._isPlaying = !0,
                this.createTween(completion))
    }
    createTween(completion) {
        var e = this;
        void 0 === completion && (completion = null),
            createjs.Tween.removeTweens(this),
            this._tween = createjs.Tween.get(this),
            this._tween.wait(33).call(function () {
                e._current_frame++ ,
                    e._img.texture = e._getTexture(e._current_frame),
                    e._setImageOffset(e._current_frame),
                    e._current_frame <= 15 ? e.createTween(completion) : (e._isPlaying = !1,
                        e._current_frame = 0,
                        null != completion && completion())
            })
    }
    stop() {
        this._isPlaying && (this._isPlaying = !1,
            this._tween.setPaused(!0)),
            this._current_frame = 0,
            this._img.texture = this._getTexture(this._current_frame),
            this._setImageOffset(this._current_frame)
    }

    _getTexture(current_frame) {
        return PIXI.Texture.WHITE
    }

    _setImageOffset(current_frame) {
        this._img.position.set(0, 0);
    }
}

class CustomLayerExplosion extends document.kcs_LayerExplosion.LayerExplosion {
    playDamageExplosionCustom(t, e, i, n) {
        void 0 === n && (n = null),
            i < 0 ? null != n && n() : i < 16 ? this.playExplosionLargeCustom(t, e, n) : i < 40 ? this.playExplosionLargeCustom(t, e, n) : this.playExplosionLargeCustom(t, e, n)
    }

    playExplosionLargeCustom(t, e, i) {
        var n = this;
        void 0 === i && (i = null),
            createjs.Tween.get(this).call(function () {
                // document.kcs_SE.SE.play("104"),
                n._explodeCustom(t - 5, e + 33)
            }).wait(100).call(function () {
                n._explodeCustom(t + 48, e - 24)
            }).wait(100).call(function () {
                n._explodeCustom(t - 50, e - 8, i)
            })
    }

    _explodeCustom(t, e, i) {
        var n = this;
        void 0 === i && (i = null);
        var o = new CustomExplosion();
        o.position.set(t, e),
            this.addChild(o),
            o.play(function () {
                n.removeChild(o),
                    null != i && i()
            })
    }
}
document.kcs_LayerExplosion.LayerExplosion = CustomLayerExplosion


//PIXI
class CustomLoader extends PIXI.loaders.Loader {
    add(name, url, options, cb) {
        if (Object.prototype.toString.call(name) === "[object String]", url == null, options == null, cb == null) {
            return super.add(name, { crossOrigin: true })
        } else {
            options.crossOrigin = true
            return super.add(name, url, options, cb)
        }
    }
}
PIXI.loaders.Loader = CustomLoader

KCS.init()
